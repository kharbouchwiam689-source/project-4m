<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Demande de Congé</title>

<style>
    * {
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, sans-serif;
    }

    body {
        margin: 0;
        background: #f4f6f9;
        display: flex;
    }

    /* SIDEBAR */
    .sidebar {
        width: 260px;
        background: white;
        height: 100vh;
        padding: 25px 20px;
        box-shadow: 2px 0 10px rgba(0,0,0,0.08);
        position: fixed;
        left: 0;
        top: 0;
        transition: transform 0.3s ease;
    }

    .sidebar.hidden {
        transform: translateX(-270px);
    }

    .sidebar h2 {
        margin-bottom: 30px;
        color: #2e7d32;
        font-size: 22px;
    }

    .sidebar a {
        text-decoration: none;
        padding: 12px 15px;
        margin-bottom: 10px;
        background: #f5f5f5;
        border-radius: 8px;
        display: block;
        color: #333;
        font-weight: 600;
        transition: 0.25s;
    }

    .sidebar a:hover {
        background: #4CAF50;
        color: white;
    }

    /* MAIN */
    .main {
        margin-left: 280px;
        padding: 30px;
        width: calc(100% - 280px);
        transition: margin-left 0.3s ease;
    }

    .main.expanded {
        margin-left: 0;
        width: 100%;
    }

    header {
        display: flex;
        align-items: center;
        background: white;
        padding: 18px 25px;
        border-radius: 14px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        margin-bottom: 25px;
    }

    .menu-btn {
        font-size: 26px;
        cursor: pointer;
        margin-right: 20px;
        user-select: none;
    }

    header img {
        height: 45px;
        margin-right: 15px;
    }

    header h1 {
        margin: 0;
        font-size: 22px;
        color: #333;
    }

    /* SOLDE CARD */
    .solde-card {
        background: linear-gradient(135deg, #4CAF50, #2e7d32);
        color: white;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        text-align: center;
        margin-bottom: 25px;
    }

    .solde-card h2 {
        margin: 0;
        font-size: 18px;
        font-weight: normal;
    }

    .solde-number {
        font-size: 34px;
        font-weight: bold;
        margin-top: 10px;
    }

    /* FORM CARD */
    .form-card {
        background: white;
        padding: 35px;
        border-radius: 18px;
        box-shadow: 0 15px 30px rgba(0,0,0,0.08);
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 18px;
    }

    .full {
        grid-column: span 2;
    }

    label {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 5px;
        display: block;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 14px;
    }

    input:disabled {
        background: #f3f3f3;
        color: #666;
    }

    textarea {
        resize: vertical;
        min-height: 110px;
    }

    .duration {
        margin-top: 10px;
        font-weight: bold;
        color: #2e7d32;
    }

    button {
        grid-column: span 2;
        margin-top: 25px;
        padding: 14px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
    }

    button:hover {
        background: #43a047;
        transform: translateY(-1px);
    }

    .success {
        margin-top: 15px;
        text-align: center;
        color: #2e7d32;
        font-weight: bold;
        display: none;
    }
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <h2>Employee Panel</h2>
    <a href="home_emp.html">Profil</a>
    <a href="demande.html">Demande congé</a>
    <a href="historique_emp.html">Historique</a>
    <a href="notif.html">Notifications</a>
</div>

<!-- MAIN -->
<div class="main" id="main">

    <header>
        <span class="menu-btn" id="menuToggle">☰</span>
        <img src="c:\Users\PC\OneDrive - Ecole Marocaine des Sciences de l'Ingénieur\Documents\GitHub\project-4m\images\business-company-logo-png_seeklogo-388541 (1).png" alt="Logo">
        <h1>Demande de Congé</h1>
    </header>

    <div class="solde-card">
        <h2>Solde de congés</h2>
        <div class="solde-number" id="soldeDisplay">0 jours</div>
    </div>

    <div class="form-card">
        <div class="grid">

            <div>
                <label>Nom complet</label>
                <input type="text" id="fullName" disabled>
            </div>

            <div>
                <label>CIN</label>
                <input type="text" id="cin" disabled>
            </div>

            <div>
                <label>Département</label>
                <input type="text" id="departement" disabled>
            </div>

            <div>
                <label>Spécialité</label>
                <input type="text" id="specialite" disabled>
            </div>

            <div class="full">
                <label>Type de congé</label>
                <select id="typeConge">
                    <option value="">-- Sélectionner --</option>
                    <option>Congé annuel</option>
                    <option>Congé maladie</option>
                    <option>Congé exceptionnel</option>
                    <option>Congé maternité/paternité</option>
                    <option>Autre</option>
                </select>
            </div>

            <div>
                <label>Date de début</label>
                <input type="date" id="dateDebut">
            </div>

            <div>
                <label>Date de fin</label>
                <input type="date" id="dateFin">
            </div>

            <div class="full duration" id="durationPreview"></div>

            <div class="full">
                <label>Motif / Explication</label>
                <textarea id="motif" placeholder="Décrivez la raison de votre demande..."></textarea>
            </div>

            <button id="sendBtn">Envoyer la demande</button>
        </div>

        <div class="success" id="successMsg">
            Votre demande a été envoyée avec succès ✔
        </div>
    </div>
</div>

<script>
    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!user) window.location.href = "login_emp.html";

    fullName.value = user.nom + " " + user.prenom;
    cin.value = user.cin;
    departement.value = user.departement;
    specialite.value = user.specialite;

    let solde = Number(localStorage.getItem("solde_" + user.cin)) || 29;
    localStorage.setItem("solde_" + user.cin, solde);
    soldeDisplay.textContent = solde + " jours";

    function updateDuration() {
        if (!dateDebut.value || !dateFin.value) return;
        const d = (new Date(dateFin.value) - new Date(dateDebut.value)) / 86400000 + 1;
        durationPreview.textContent = "Durée demandée : " + d + " jours";
    }

    dateDebut.onchange = updateDuration;
    dateFin.onchange = updateDuration;

    sendBtn.onclick = () => {
        if (!typeConge.value || !dateDebut.value || !dateFin.value || !motif.value) {
            alert("Veuillez remplir tous les champs.");
            return;
        }

        const debut = new Date(dateDebut.value);
        const fin = new Date(dateFin.value);
        const diffDays = (fin - debut) / 86400000 + 1;

        if (diffDays > 10) {
            alert("Maximum 10 jours de congé.");
            return;
        }

        if (diffDays > solde) {
            alert("Solde insuffisant.");
            return;
        }

        const demandes = JSON.parse(localStorage.getItem("demandesConge")) || [];

        demandes.push({
            cin: user.cin,
            fullName: user.nom + " " + user.prenom,
            departement: user.departement,
            specialite: user.specialite,
            typeConge: typeConge.value,
            dateDebut: dateDebut.value,
            dateFin: dateFin.value,
            motif: motif.value,
            statut: "pending",
            dateEnvoi: new Date().toLocaleString()
        });

        localStorage.setItem("demandesConge", JSON.stringify(demandes));

        solde -= diffDays;
        localStorage.setItem("solde_" + user.cin, solde);
        soldeDisplay.textContent = solde + " jours";

        successMsg.style.display = "block";
        typeConge.value = dateDebut.value = dateFin.value = motif.value = "";
        durationPreview.textContent = "";
    };

    menuToggle.onclick = () => {
        sidebar.classList.toggle("hidden");
        main.classList.toggle("expanded");
    };
</script>

</body>
</html>
