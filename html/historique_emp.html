<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique des Congés</title>

<style>
    body {
        margin:0;
        font-family: Arial, sans-serif;
        background:#f2f2f2;
        display:flex;
    }

    /* SIDEBAR */
    .sidebar {
        width:250px;
        background:white;
        height:100vh;
        padding:20px;
        box-shadow:3px 0 8px rgba(0,0,0,0.1);
        position:fixed;
        left:0;
        top:0;
        display:flex;
        flex-direction:column;
        transition:transform 0.3s ease;
    }

    .sidebar.hidden {
        transform: translateX(-260px);
    }

    .sidebar h2 {
        margin:0 0 20px 0;
        font-size:22px;
    }

    .sidebar a {
        text-decoration:none;
        padding:12px;
        margin:5px 0;
        background:#f5f5f5;
        border-radius:6px;
        display:block;
        color:#333;
        font-weight:bold;
        transition:0.2s;
    }
    .sidebar a:hover {
        background:#ddd;
    }

    /* MAIN */
    .main {
        margin-left:270px;
        padding:30px;
        width:calc(100% - 270px);
        transition:margin-left 0.3s ease;
    }
    .main.expanded {
        margin-left:0;
        width:100%;
    }

    /* HEADER */
    header {
        display:flex;
        align-items:center;
        padding:10px 20px;
        background:blanchedalmond;
        border-radius:10px;
        margin-bottom:20px;
    }
    .menu-btn {
        font-size:26px;
        cursor:pointer;
        margin-right:20px;
    }
    header img {
        height:65px;
        margin-right:15px;
    }

    /* CONTAINER */
    .container {
        background:white;
        padding:25px;
        border-radius:10px;
        box-shadow:0 0 15px rgba(0,0,0,0.1);
    }

    h1 {
        text-align:center;
        margin-bottom:25px;
    }

    /* TABLE */
    table {
        width:100%;
        border-collapse:collapse;
        margin-top:20px;
    }

    table th, table td {
        padding:12px;
        border:1px solid #ccc;
        text-align:left;
    }

    table th {
        background:#f5f5f5;
    }

    .status {
        font-weight:bold;
        padding:6px 10px;
        border-radius:6px;
        text-align:center;
        width:120px;
    }

    .pending { background:#ffe9a6; color:#8a6d00; }
    .approved { background:#c9ffca; color:#0d7a0d; }
    .refused { background:#ffb5b5; color:#7a0000; }
</style>

</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <h2>Navigation</h2>
    <a href="home_emp.html">Profil</a>
    <a href="demande.html">Demande congé</a>
    <a href="historique_emp.html">Historique</a>
    <a href="calendrier.html">Calendrier</a>
    <a href="solde.html">Solde</a>
</div>

<!-- MAIN -->
<div class="main" id="main">

    <header>
        <span class="menu-btn" id="menuToggle">☰</span>
        <img src="c:\Users\PC\OneDrive - Ecole Marocaine des Sciences de l'Ingénieur\Bureau\prjt 4 subjects\images\corporate-business-logo-png_seeklogo-386910.png">
        <h1>Historique des demandes</h1>
    </header>

    <div class="container">

        <h2>Vos demandes de congé</h2>

        <table id="tableHistorique">
            <tr>
                <th>Type</th>
                <th>Date début</th>
                <th>Date fin</th>
                <th>Motif</th>
                <th>Date d'envoi</th>
                <th>Statut</th>
            </tr>
        </table>

    </div>
</div>

<script>
    /* LOAD USER */
    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!user) window.location.href = "login_emp.html";

    /* LOAD ALL REQUESTS */
    let demandes = JSON.parse(localStorage.getItem("demandesConge")) || [];

    /* FILTER ONLY THIS USER */
    demandes = demandes.filter(d => d.cin === user.cin);

    const table = document.getElementById("tableHistorique");

    if (demandes.length === 0) {
        table.innerHTML += `
            <tr><td colspan="6" style="text-align:center; padding:20px; color:#777;">
                Aucune demande trouvée.
            </td></tr>
        `;
    } else {
        demandes.forEach(d => {
            const statut = d.statut || "En attente";

            let css = "pending";
            if (statut === "Approuvée") css = "approved";
            if (statut === "Refusée") css = "refused";

            table.innerHTML += `
                <tr>
                    <td>${d.typeConge}</td>
                    <td>${d.dateDebut}</td>
                    <td>${d.dateFin}</td>
                    <td>${d.motif}</td>
                    <td>${d.dateEnvoi}</td>
                    <td><span class="status ${css}">${statut}</span></td>
                </tr>
            `;
        });
    }

    /* SIDEBAR TOGGLE */
    const sidebar = document.getElementById("sidebar");
    const main = document.getElementById("main");
    const toggle = document.getElementById("menuToggle");

    toggle.addEventListener("click", () => {
        sidebar.classList.toggle("hidden");
        main.classList.toggle("expanded");
    });
</script>

</body>
</html>
