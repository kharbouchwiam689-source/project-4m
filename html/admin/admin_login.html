<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connexion Admin</title>

  <style>
    * { box-sizing: border-box; font-family: "Segoe UI", Tahoma, sans-serif; }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      background: linear-gradient(135deg, #4CAF50, #2e7d32);
    }

    .card{
      width:420px;
      max-width:100%;
      background:#fff;
      border-radius:16px;
      padding:34px;
      box-shadow:0 20px 40px rgba(0,0,0,0.20);
      animation: fadeIn .5s ease;
    }

    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(16px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:center;
      margin-bottom:8px;
    }

    .brand img{
      width:44px;
      height:44px;
      border-radius:12px;
      border:1px solid #e6e6e6;
      object-fit:cover;
      background:#fff;
    }

    h1{
      margin:0;
      font-size:22px;
      color:#2e7d32;
      text-align:center;
    }

    .subtitle{
      margin:10px 0 22px;
      text-align:center;
      color:#666;
      font-size:14px;
      line-height:1.4;
    }

    label{
      display:block;
      margin:14px 0 6px;
      font-weight:600;
      font-size:14px;
      color:#333;
    }

    input{
      width:100%;
      padding:11px 12px;
      border-radius:10px;
      border:1px solid #ccc;
      font-size:14px;
      transition:.2s;
    }

    input:focus{
      outline:none;
      border-color:#4CAF50;
      box-shadow:0 0 0 3px rgba(76,175,80,0.18);
      background:#fff;
    }

    button{
      width:100%;
      margin-top:18px;
      padding:12px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      font-size:16px;
      color:#fff;
      background:#4CAF50;
      transition:.2s;
    }

    button:hover{
      background:#43a047;
      transform: translateY(-1px);
    }

    .msg{
      margin-top:14px;
      padding:10px 12px;
      border-radius:10px;
      font-size:13px;
      display:none;
    }

    .msg.error{
      display:block;
      background:#ffebee;
      color:#c62828;
      border:1px solid rgba(198,40,40,0.25);
    }

    .msg.info{
      display:block;
      background:#e8f5e9;
      color:#1b5e20;
      border:1px solid rgba(27,94,32,0.2);
    }

    .hint{
      margin-top:16px;
      font-size:12px;
      color:#777;
      text-align:center;
    }

    code{
      background:#f5f5f5;
      padding:2px 6px;
      border-radius:6px;
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="brand">
      <img src="images/logo.png" alt="Logo">
      <h1>Administration</h1>
    </div>

    <p class="subtitle">
      Connectez-vous pour gérer les demandes, comptes utilisateurs, calendriers et statistiques.
    </p>

    <form id="adminLoginForm" autocomplete="on">
      <label for="email">Email</label>
      <input id="email" type="email" placeholder="admin@demo.com" required />

      <label for="password">Mot de passe</label>
      <input id="password" type="password" placeholder="••••••••" required />

      <button type="submit">Se connecter</button>

      <div id="message" class="msg"></div>
    </form>

    <div class="hint">
      Compte admin par défaut (démo) : <code>admin@demo.com</code> / <code>admin123</code>
    </div>
  </div>

  <script>
    // Simple hash for demo consistency
    function hashPassword(pwd){
      return btoa(pwd);
    }

    // Create a default admin if none exists
    const DEFAULT_ADMIN = {
      email: "admin@demo.com",
      password: hashPassword("admin123"),
      role: "admin",
      name: "Administrator"
    };

    function ensureDefaultAdmin(){
      const admins = JSON.parse(localStorage.getItem("admins")) || [];
      const exists = admins.some(a => a.email === DEFAULT_ADMIN.email);
      if (!exists) {
        admins.push(DEFAULT_ADMIN);
        localStorage.setItem("admins", JSON.stringify(admins));
      }
    }

    ensureDefaultAdmin();

    const form = document.getElementById("adminLoginForm");
    const msg = document.getElementById("message");

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      msg.className = "msg";
      msg.style.display = "none";
      msg.textContent = "";

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      const admins = JSON.parse(localStorage.getItem("admins")) || [];

      // Backward compatible: accept plain OR hashed password (migrate to hashed)
      let foundAdmin = null;

      for (const admin of admins) {
        // old (plain)
        if (admin.email === email && admin.password === password) {
          admin.password = hashPassword(password);
          localStorage.setItem("admins", JSON.stringify(admins));
          foundAdmin = admin;
          break;
        }
        // new (hashed)
        if (admin.email === email && admin.password === hashPassword(password)) {
          foundAdmin = admin;
          break;
        }
      }

      if (foundAdmin) {
        localStorage.setItem("adminUser", JSON.stringify(foundAdmin));
        window.location.href = "admin_home.html";
      } else {
        msg.textContent = "Email ou mot de passe incorrect.";
        msg.className = "msg error";
        msg.style.display = "block";
      }
    });
  </script>
</body>
</html>
